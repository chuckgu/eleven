# Eleven FC — Phase 1 기획서

## 1. Phase 1 목표: LLM 기반 의사결정 프로토타입

Phase 0에서 구축한 규칙 기반 시뮬레이션을 한 단계 확장하여, **1개의 LLM이 주기적으로 10명의 선수 행동을 공동 결정**하는 프로토타입을 완성합니다.

- **핵심 목표**: 5v5 시뮬레이션 + LLM 의사결정 + 기본 전술 UI + 스쿼드 관리
- **성공 기준**:
  - LLM이 생성한 의도가 실제 경기 흐름에 반영되고, 규칙 기반 대비 뚜렷한 행동 다양성을 보여줌
  - 호출 주기를 1초→500ms 수준까지 단계적으로 단축해도 안정적으로 동작함
  - 감독(플레이어)이 전술 캔버스로 의도 생산에 영향을 줄 수 있음

## 2. 주요 기능

### 2.1. LLM 의사결정 루프

- **공동 의도 생성**:
  - 1개의 LLM 호출에서 10명의 선수 의도를 동시에 생성 (`action_plan` JSON)
  - 각 선수별 구조 예시: `{ "player_id": 3, "intent": { "status": "NEW", "action": "ATTACK_SPACE", "target": {"x": 40, "y": 78} } }`

- **주기 관리**:
  - 판단 주기 = LLM 호출 주기. 초기 1초 → 800ms → 600ms → 500ms 순으로 축소 시험
  - LLM 호출이 지연되면 즉시 주기 확대 및 기존 의도 유지

- **의도 라이프사이클**:
  - LLM은 선수별로 `CONTINUE`(이전 의도 유지) 또는 `NEW`(새 의도) 상태를 반환
  - `CONTINUE`만 받은 선수는 마지막 의도를 그대로 연장
  - `NEW`를 받은 선수는 즉시 새로운 행동 계획으로 갱신

- **수행 엔진 (10Hz)**:
  - `sim-core`는 10Hz(100ms) 틱마다 최신 의도를 조회해 저수준 행동(`move_towards`, `avoid_collision` 등)을 수행
  - 의도가 완료된 후 새 판단이 도착하지 않으면 `IDLE` 상태(제자리 유지 또는 기본 포지션 유지)
  - 공 소유권 변화, 세트피스 등 중대한 이벤트 시 즉시 LLM 재호출 트리거

### 2.2. 감독 상호작용: Tactical Canvas

- **드래그 앤 드롭 UI**:
  - 선수 역할을 경기장에 배치하여 LLM 프롬프트 컨텍스트에 반영
  - 역할 예시: "Target Man", "Ball-Playing Defender", "Wing Back"

- **전술 신호 입력**:
  - 감독이 설정한 전술 플래그(공격/수비 밸런스, 압박 높이 등)를 LLM 호출 시 추가 컨텍스트로 전달

### 2.3. 스쿼드 관리 및 선수 성장

- **로스터 관리**:
  - 10명 로스터(선발 5, 후보 5)와 경기 전 라인업 설정

- **성장 시스템**:
  - 경기 결과 및 LLM 의도 수행 결과(성공/실패)를 기반으로 페르소나 파라미터 조정
  - 예: 위험 선호도가 높은 의도를 반복 수행할수록 `risk_appetite` 상승

### 2.4. UI/UX 개선

- **의도 대시보드**:
  - 선수별 현재 의도 상태(NEW/CONTINUE/IDLE), 신뢰도, 남은 지속시간 표시
  - LLM 호출 지연 및 실패 정보 표시

- **경기 결과 화면**:
  - 주요 스탯(점유율, 슈팅 수, 패스 성공률) 및 의도 성공률 요약

## 3. 기술 스택 확장

- **LLM 연동**:
  - `(1단계)` llama.cpp + GGUF 모델을 프로세스 내부에서 직접 호출하는 `decision-plugin` 구현 (HTTP 미사용)
  - 우선 모델: [Qwen/Qwen3-8B-GGUF](https://huggingface.co/Qwen/Qwen3-8B-GGUF) `q4_k_m` (약 5.0GB)
  - llama.cpp Metal 빌드 + Rust 바인딩으로 함수 호출 형태 API 제공
  - `LLMEngine` 추상화 인터페이스를 두어 이후 HTTP/Ollama 전환 가능하도록 준비
  - 호출 컨텍스트: 최근 이벤트 집합 + 선수 상태 + 전술 설정 + 기존 의도 상태

- **UI**:
  - `bevy_egui`로 전술 캔버스, 의도 대시보드, 스쿼드 관리 UI 구현

- **데이터 영속성**:
  - `storage` 크레이트에서 선수 상태, 의도 로그, 경기 결과 영속화

## 4. Phase 1 범위

- **In-Scope**:
  - 5v5 시뮬레이션
  - LLM 기반 의사결정 루프 및 의도 실행 엔진
  - 전술 캔버스, 스쿼드 관리, 선수 성장
  - 의도/전술 UI, 경기 결과 요약

- **Out-of-Scope**:
  - 실시간 해설(NLG) 및 하이라이트 생성
  - 11v11, 온라인 멀티플레이어, 3D 그래픽
  - 시즌/리그 운영

## 5. 일정 (3개월)

- **1개월차**: LLM 의사결정 루프, `decision-plugin`, 의도 실행 엔진 프로토타입
- **2개월차**: 전술 캔버스 UI, 스쿼드 관리, 성능/지연 모니터링
- **3개월차**: 선수 성장 로직, 데이터 영속성, 전체 통합 및 테스트
